2025-12-28 10:49:33,499 - root - INFO - Logging initialized. Level: INFO
2025-12-28 10:49:35,406 - root - INFO - Logging initialized. Level: INFO
2025-12-28 10:49:50,897 - root - INFO - Logging initialized. Level: INFO
2025-12-28 10:50:10,290 - root - INFO - Logging initialized. Level: INFO
2025-12-28 10:50:10,290 - test_logger - INFO - This is a test INFO log message.
2025-12-28 10:50:10,290 - test_logger - WARNING - This is a test WARNING log message.
2025-12-30 22:39:52,071 - root - INFO - Logging initialized. Level: INFO
2025-12-30 22:39:52,071 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:06:48,388 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-30 23:06:48,388 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:06:48,390 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-30 23:06:48,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:06:48,392 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-30 23:06:48,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:06:48,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:06:48,397 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-30 23:06:48,397 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('login_api@example.com',)
2025-12-30 23:06:48,461 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:12:34,963 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:12:34,964 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-30 23:12:34,964 - sqlalchemy.engine.Engine - INFO - [cached since 352.6s ago] ('login_api@example.com',)
2025-12-30 23:12:35,045 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:14:14,414 - uvicorn.error - INFO - Shutting down
2025-12-30 23:14:14,515 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:14:14,516 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:14:14,517 - uvicorn.error - INFO - Finished server process [146956]
2025-12-30 23:14:15,529 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:14:15,529 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:14:16,233 - uvicorn.error - INFO - Shutting down
2025-12-30 23:14:16,335 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:14:16,335 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:14:16,336 - uvicorn.error - INFO - Finished server process [168492]
2025-12-30 23:14:17,310 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:14:17,310 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:14:45,752 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-30 23:14:45,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:14:45,755 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-30 23:14:45,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:14:45,757 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-30 23:14:45,757 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-30 23:14:45,759 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:14:45,763 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-30 23:14:45,763 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ('login_api@example.com',)
2025-12-30 23:14:45,845 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:14:46,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:14:46,176 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:14:46,177 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:14:46,182 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:14:46,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:14:46,185 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:15:07,528 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:15:07,529 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:15:07,529 - sqlalchemy.engine.Engine - INFO - [cached since 21.35s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:15:07,533 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:15:07,533 - sqlalchemy.engine.Engine - INFO - [cached since 21.35s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:15:07,536 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:18:27,236 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:18:27,236 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:18:27,236 - sqlalchemy.engine.Engine - INFO - [cached since 223.4s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:18:27,238 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:18:27,238 - sqlalchemy.engine.Engine - INFO - [cached since 223.4s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:18:27,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:19:26,700 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:19:26,702 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:19:26,702 - sqlalchemy.engine.Engine - INFO - [cached since 282.8s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:19:26,705 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:19:26,705 - sqlalchemy.engine.Engine - INFO - [cached since 282.8s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:19:26,708 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:24:51,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:24:51,996 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:24:51,996 - sqlalchemy.engine.Engine - INFO - [cached since 611s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:24:51,998 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:24:51,998 - sqlalchemy.engine.Engine - INFO - [cached since 611s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:24:51,999 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:26:19,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:26:19,902 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:26:19,903 - sqlalchemy.engine.Engine - INFO - [cached since 700s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:26:19,904 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:26:19,904 - sqlalchemy.engine.Engine - INFO - [cached since 700s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:26:19,906 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:31:43,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:31:43,585 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:31:43,585 - sqlalchemy.engine.Engine - INFO - [cached since 1029s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:31:43,587 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:31:43,587 - sqlalchemy.engine.Engine - INFO - [cached since 1029s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:31:43,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:32:16,064 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:32:16,065 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-30 23:32:16,065 - sqlalchemy.engine.Engine - INFO - [cached since 1063s ago] ('login_api@example.com',)
2025-12-30 23:32:16,141 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:32:16,160 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:32:16,161 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:32:16,162 - sqlalchemy.engine.Engine - INFO - [cached since 1062s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:32:16,164 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:32:16,165 - sqlalchemy.engine.Engine - INFO - [cached since 1062s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:32:16,168 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:32:37,542 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:32:37,542 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-30 23:32:37,543 - sqlalchemy.engine.Engine - INFO - [cached since 1084s ago] ('login_api@example.com',)
2025-12-30 23:32:37,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:32:37,632 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:32:37,633 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:32:37,633 - sqlalchemy.engine.Engine - INFO - [cached since 1084s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:32:37,636 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:32:37,637 - sqlalchemy.engine.Engine - INFO - [cached since 1084s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:32:37,639 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:41:21,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-30 23:41:21,007 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-30 23:41:21,008 - sqlalchemy.engine.Engine - INFO - [cached since 1611s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:41:21,010 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-30 23:41:21,011 - sqlalchemy.engine.Engine - INFO - [cached since 1611s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-30 23:41:21,057 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-30 23:49:15,355 - uvicorn.error - INFO - Shutting down
2025-12-30 23:49:15,456 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:49:15,457 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:49:15,457 - uvicorn.error - INFO - Finished server process [168512]
2025-12-30 23:49:16,435 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:49:16,435 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:49:18,147 - uvicorn.error - INFO - Shutting down
2025-12-30 23:49:18,249 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:49:18,249 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:49:18,250 - uvicorn.error - INFO - Finished server process [186532]
2025-12-30 23:49:19,228 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:49:19,228 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:49:19,834 - uvicorn.error - INFO - Shutting down
2025-12-30 23:49:19,508 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:49:19,509 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:49:19,510 - uvicorn.error - INFO - Finished server process [186579]
2025-12-30 23:49:20,458 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:49:20,459 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:50:13,509 - uvicorn.error - INFO - Shutting down
2025-12-30 23:50:13,610 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:50:13,611 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:50:13,611 - uvicorn.error - INFO - Finished server process [186621]
2025-12-30 23:57:47,849 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:57:47,849 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:57:48,181 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'UserPreference'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 615, in solve_dependencies
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/dependencies/auth.py", line 49, in get_current_user
    user = await user_repo.get_by_id(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 32, in get_by_id
    select(User).options(selectinload(User.versions)).where(User.id == user_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2447, in selectinload
    return _generate_from_keys(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 595, in init
    self.do_init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1655, in do_init
    self._setup_entity()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1865, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-30 23:58:12,732 - uvicorn.error - INFO - Shutting down
2025-12-30 23:58:12,833 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:58:12,834 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:58:12,834 - uvicorn.error - INFO - Finished server process [191512]
2025-12-30 23:58:13,805 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:58:13,806 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:58:55,600 - uvicorn.error - INFO - Shutting down
2025-12-30 23:58:55,702 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:58:55,703 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:58:55,703 - uvicorn.error - INFO - Finished server process [191895]
2025-12-30 23:58:56,677 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:58:56,678 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:59:23,144 - uvicorn.error - INFO - Shutting down
2025-12-30 23:59:23,245 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:59:23,246 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:59:23,246 - uvicorn.error - INFO - Finished server process [192299]
2025-12-30 23:59:24,297 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:59:24,297 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:59:56,524 - uvicorn.error - INFO - Shutting down
2025-12-30 23:59:56,625 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:59:56,626 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:59:56,627 - uvicorn.error - INFO - Finished server process [192599]
2025-12-30 23:59:57,655 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:59:57,655 - uvicorn.error - INFO - Application startup complete.
2025-12-30 23:59:58,666 - uvicorn.error - INFO - Shutting down
2025-12-30 23:59:58,767 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-30 23:59:58,768 - uvicorn.error - INFO - Application shutdown complete.
2025-12-30 23:59:58,769 - uvicorn.error - INFO - Finished server process [192946]
2025-12-30 23:59:59,361 - root - INFO - Logging initialized. Level: INFO
2025-12-30 23:59:59,362 - uvicorn.error - INFO - Application startup complete.
2025-12-31 00:00:43,417 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'UserPreference'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 615, in solve_dependencies
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/dependencies/auth.py", line 49, in get_current_user
    user = await user_repo.get_by_id(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 32, in get_by_id
    select(User).options(selectinload(User.versions)).where(User.id == user_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2447, in selectinload
    return _generate_from_keys(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 595, in init
    self.do_init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1655, in do_init
    self._setup_entity()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1865, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:02:08,781 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 615, in solve_dependencies
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/dependencies/auth.py", line 49, in get_current_user
    user = await user_repo.get_by_id(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 32, in get_by_id
    select(User).options(selectinload(User.versions)).where(User.id == user_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2447, in selectinload
    return _generate_from_keys(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(user)]'. Original exception was: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:02:15,728 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 615, in solve_dependencies
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/dependencies/auth.py", line 49, in get_current_user
    user = await user_repo.get_by_id(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 32, in get_by_id
    select(User).options(selectinload(User.versions)).where(User.id == user_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2447, in selectinload
    return _generate_from_keys(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(user)]'. Original exception was: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:03:05,353 - app.core.security - WARNING - Invalid token decode attempt: Signature has expired
2025-12-31 00:04:43,438 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/routes/auth.py", line 54, in login
    user = await auth_service.authenticate_user(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/services/auth.py", line 76, in authenticate_user
    user = await self.user_repo.get_by_email(login_data.email)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 21, in get_by_email
    .options(joinedload(User.versions))  # Optimize if we need version data
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2435, in joinedload
    return _generate_from_keys(Load.joinedload, keys, False, kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(user)]'. Original exception was: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:05:06,022 - uvicorn.error - INFO - Shutting down
2025-12-31 00:05:06,124 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-31 00:05:06,126 - uvicorn.error - INFO - Application shutdown complete.
2025-12-31 00:05:06,127 - uvicorn.error - INFO - Finished server process [192993]
2025-12-31 00:05:09,737 - root - INFO - Logging initialized. Level: INFO
2025-12-31 00:05:09,737 - uvicorn.error - INFO - Application startup complete.
2025-12-31 00:05:14,154 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'UserPreference'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/routes/auth.py", line 54, in login
    user = await auth_service.authenticate_user(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/services/auth.py", line 76, in authenticate_user
    user = await self.user_repo.get_by_email(login_data.email)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 21, in get_by_email
    .options(joinedload(User.versions))  # Optimize if we need version data
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2435, in joinedload
    return _generate_from_keys(Load.joinedload, keys, False, kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 595, in init
    self.do_init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1655, in do_init
    self._setup_entity()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1865, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:05:29,019 - uvicorn.error - INFO - Shutting down
2025-12-31 00:05:29,121 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-31 00:05:29,121 - uvicorn.error - INFO - Application shutdown complete.
2025-12-31 00:05:29,122 - uvicorn.error - INFO - Finished server process [195883]
2025-12-31 00:05:32,881 - root - INFO - Logging initialized. Level: INFO
2025-12-31 00:05:32,881 - uvicorn.error - INFO - Application startup complete.
2025-12-31 00:05:39,108 - uvicorn.error - ERROR - Exception in ASGI application
Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'UserPreference'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/api/routes/auth.py", line 54, in login
    user = await auth_service.authenticate_user(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/services/auth.py", line 76, in authenticate_user
    user = await self.user_repo.get_by_email(login_data.email)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/app/repositories/user.py", line 21, in get_by_email
    .options(joinedload(User.versions))  # Optimize if we need version data
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2435, in joinedload
    return _generate_from_keys(Load.joinedload, keys, False, kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 2327, in _generate_from_keys
    lead_element = Load(lead_entity)
                   ^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py", line 1013, in __init__
    insp._post_inspect
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 595, in init
    self.do_init()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1655, in do_init
    self._setup_entity()
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1865, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/nicola/dev/backcast_evs/backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[User(user)], expression 'UserPreference' failed to locate a name ('UserPreference'). If this is a class name, consider adding this relationship() to the <class 'app.models.domain.user.User'> class after both dependent classes have been defined.
2025-12-31 00:07:14,874 - uvicorn.error - INFO - Shutting down
2025-12-31 00:07:14,975 - uvicorn.error - INFO - Waiting for application shutdown.
2025-12-31 00:07:14,976 - uvicorn.error - INFO - Application shutdown complete.
2025-12-31 00:07:14,976 - uvicorn.error - INFO - Finished server process [196150]
2025-12-31 00:07:15,954 - root - INFO - Logging initialized. Level: INFO
2025-12-31 00:07:15,954 - uvicorn.error - INFO - Application startup complete.
2025-12-31 00:07:27,644 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-31 00:07:27,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-31 00:07:27,710 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-31 00:07:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-31 00:07:27,718 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-31 00:07:27,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-31 00:07:27,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:27,736 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-31 00:07:27,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('login_api@example.com',)
2025-12-31 00:07:27,764 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:07:27,765 - sqlalchemy.engine.Engine - INFO - [generated in 0.00142s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:27,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:07:27,872 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:27,874 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:07:27,874 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:27,879 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:07:27,880 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:27,884 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:07:27,885 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:27,887 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:07:28,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:28,295 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:07:28,296 - sqlalchemy.engine.Engine - INFO - [cached since 0.4221s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:28,298 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:07:28,298 - sqlalchemy.engine.Engine - INFO - [cached since 0.4189s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:28,300 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:07:28,300 - sqlalchemy.engine.Engine - INFO - [cached since 0.4157s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:28,302 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:07:28,303 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:28,306 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference (user_id, id) VALUES ($1::UUID, $2::UUID)
2025-12-31 00:07:28,306 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (UUID('faeb17b1-5129-4732-b179-e04781da4472'), UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'))
2025-12-31 00:07:28,310 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference_version (head_id, theme, valid_from, valid_to, created_by_id) VALUES ($1::UUID, $2::VARCHAR, $3::TIMESTAMP WITH TIME ZONE, $4::TIMESTAMP WITH TIME ZONE, $5::UUID)
2025-12-31 00:07:28,310 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 'light', datetime.date(2025, 12, 31), None, UUID('faeb17b1-5129-4732-b179-e04781da4472'))
2025-12-31 00:07:28,314 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:07:28,320 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:28,320 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:07:28,321 - sqlalchemy.engine.Engine - INFO - [cached since 0.01837s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:28,324 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:07:28,324 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:07:28,327 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:07:47,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:47,394 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:07:47,394 - sqlalchemy.engine.Engine - INFO - [cached since 19.52s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:47,397 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:07:47,398 - sqlalchemy.engine.Engine - INFO - [cached since 19.52s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:47,399 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:07:47,399 - sqlalchemy.engine.Engine - INFO - [cached since 19.52s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:47,402 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:07:47,402 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:07:47,406 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:07:47,406 - sqlalchemy.engine.Engine - INFO - [cached since 19.1s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:47,407 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:07:47,408 - sqlalchemy.engine.Engine - INFO - [cached since 19.08s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:07:47,410 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id, user_preference_version.theme, user_preference_version.valid_from, user_preference_version.valid_to, user_preference_version.created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id = $1::UUID AND user_preference_version.valid_to IS NULL ORDER BY user_preference_version.valid_from DESC 
 LIMIT $2::INTEGER
2025-12-31 00:07:47,411 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 1)
2025-12-31 00:07:47,417 - sqlalchemy.engine.Engine - INFO - UPDATE user_preference_version SET valid_to=$1::TIMESTAMP WITH TIME ZONE WHERE user_preference_version.head_id = $2::UUID AND user_preference_version.valid_from = $3::TIMESTAMP WITH TIME ZONE
2025-12-31 00:07:47,417 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (datetime.datetime(2025, 12, 30, 23, 7, 47, 409539, tzinfo=datetime.timezone.utc), UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), datetime.datetime(2025, 12, 30, 23, 0, tzinfo=datetime.timezone.utc))
2025-12-31 00:07:47,419 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference_version (head_id, theme, valid_from, valid_to, created_by_id) VALUES ($1::UUID, $2::VARCHAR, $3::TIMESTAMP WITH TIME ZONE, $4::TIMESTAMP WITH TIME ZONE, $5::UUID)
2025-12-31 00:07:47,419 - sqlalchemy.engine.Engine - INFO - [cached since 19.11s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 'dark', datetime.datetime(2025, 12, 30, 23, 7, 47, 409539, tzinfo=datetime.timezone.utc), None, UUID('faeb17b1-5129-4732-b179-e04781da4472'))
2025-12-31 00:07:47,421 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:07:59,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:07:59,671 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:07:59,671 - sqlalchemy.engine.Engine - INFO - [cached since 32.55s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:59,673 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:07:59,674 - sqlalchemy.engine.Engine - INFO - [cached since 32.54s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:59,676 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:07:59,677 - sqlalchemy.engine.Engine - INFO - [cached since 32.54s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:59,679 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:07:59,680 - sqlalchemy.engine.Engine - INFO - [cached since 13.03s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:07:59,683 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:07:59,684 - sqlalchemy.engine.Engine - INFO - [cached since 32.13s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:07:59,685 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:07:59,685 - sqlalchemy.engine.Engine - INFO - [cached since 32.11s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:07:59,687 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id, user_preference_version.theme, user_preference_version.valid_from, user_preference_version.valid_to, user_preference_version.created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id = $1::UUID AND user_preference_version.valid_to IS NULL ORDER BY user_preference_version.valid_from DESC 
 LIMIT $2::INTEGER
2025-12-31 00:07:59,687 - sqlalchemy.engine.Engine - INFO - [cached since 13.03s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 1)
2025-12-31 00:07:59,689 - sqlalchemy.engine.Engine - INFO - UPDATE user_preference_version SET valid_to=$1::TIMESTAMP WITH TIME ZONE WHERE user_preference_version.head_id = $2::UUID AND user_preference_version.valid_from = $3::TIMESTAMP WITH TIME ZONE
2025-12-31 00:07:59,689 - sqlalchemy.engine.Engine - INFO - [cached since 13.02s ago] (datetime.datetime(2025, 12, 30, 23, 7, 59, 686973, tzinfo=datetime.timezone.utc), UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), datetime.datetime(2025, 12, 30, 23, 7, 47, 409539, tzinfo=datetime.timezone.utc))
2025-12-31 00:07:59,690 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference_version (head_id, theme, valid_from, valid_to, created_by_id) VALUES ($1::UUID, $2::VARCHAR, $3::TIMESTAMP WITH TIME ZONE, $4::TIMESTAMP WITH TIME ZONE, $5::UUID)
2025-12-31 00:07:59,691 - sqlalchemy.engine.Engine - INFO - [cached since 32.13s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 'light', datetime.datetime(2025, 12, 30, 23, 7, 59, 686973, tzinfo=datetime.timezone.utc), None, UUID('faeb17b1-5129-4732-b179-e04781da4472'))
2025-12-31 00:07:59,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:08:01,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:08:01,021 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:08:01,021 - sqlalchemy.engine.Engine - INFO - [cached since 33.9s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:08:01,024 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:08:01,024 - sqlalchemy.engine.Engine - INFO - [cached since 33.89s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:08:01,026 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:08:01,026 - sqlalchemy.engine.Engine - INFO - [cached since 33.89s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:08:01,028 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:08:01,028 - sqlalchemy.engine.Engine - INFO - [cached since 14.38s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:08:01,030 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:08:01,031 - sqlalchemy.engine.Engine - INFO - [cached since 33.48s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:08:01,033 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:08:01,033 - sqlalchemy.engine.Engine - INFO - [cached since 33.46s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:08:01,034 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id, user_preference_version.theme, user_preference_version.valid_from, user_preference_version.valid_to, user_preference_version.created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id = $1::UUID AND user_preference_version.valid_to IS NULL ORDER BY user_preference_version.valid_from DESC 
 LIMIT $2::INTEGER
2025-12-31 00:08:01,035 - sqlalchemy.engine.Engine - INFO - [cached since 14.37s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 1)
2025-12-31 00:08:01,036 - sqlalchemy.engine.Engine - INFO - UPDATE user_preference_version SET valid_to=$1::TIMESTAMP WITH TIME ZONE WHERE user_preference_version.head_id = $2::UUID AND user_preference_version.valid_from = $3::TIMESTAMP WITH TIME ZONE
2025-12-31 00:08:01,036 - sqlalchemy.engine.Engine - INFO - [cached since 14.37s ago] (datetime.datetime(2025, 12, 30, 23, 8, 1, 34391, tzinfo=datetime.timezone.utc), UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), datetime.datetime(2025, 12, 30, 23, 7, 59, 686973, tzinfo=datetime.timezone.utc))
2025-12-31 00:08:01,037 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference_version (head_id, theme, valid_from, valid_to, created_by_id) VALUES ($1::UUID, $2::VARCHAR, $3::TIMESTAMP WITH TIME ZONE, $4::TIMESTAMP WITH TIME ZONE, $5::UUID)
2025-12-31 00:08:01,038 - sqlalchemy.engine.Engine - INFO - [cached since 33.48s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 'dark', datetime.datetime(2025, 12, 30, 23, 8, 1, 34391, tzinfo=datetime.timezone.utc), None, UUID('faeb17b1-5129-4732-b179-e04781da4472'))
2025-12-31 00:08:01,039 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:09:38,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:09:38,402 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id, user_version_1.head_id, user_version_1.full_name, user_version_1.role, user_version_1.department, user_version_1.is_active, user_version_1.valid_from, user_version_1.valid_to, user_version_1.created_by_id 
FROM "user" LEFT OUTER JOIN user_version AS user_version_1 ON "user".id = user_version_1.head_id 
WHERE "user".email = $1::VARCHAR ORDER BY user_version_1.valid_from DESC
2025-12-31 00:09:38,402 - sqlalchemy.engine.Engine - INFO - [cached since 133.2s ago] ('login_api@example.com',)
2025-12-31 00:09:38,405 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:09:38,405 - sqlalchemy.engine.Engine - INFO - [cached since 133.2s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,408 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:38,408 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:38,519 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:09:38,860 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:09:38,860 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:09:38,861 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,863 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:09:38,864 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,866 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:09:38,867 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,870 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:38,870 - sqlalchemy.engine.Engine - INFO - [cached since 114.1s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:38,874 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:09:38,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:09:38,910 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:09:38,910 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,912 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:09:38,912 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,914 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:09:38,914 - sqlalchemy.engine.Engine - INFO - [cached since 133.6s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,917 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:38,917 - sqlalchemy.engine.Engine - INFO - [cached since 114.1s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:38,919 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:09:38,919 - sqlalchemy.engine.Engine - INFO - [cached since 133.2s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:38,922 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:38,922 - sqlalchemy.engine.Engine - INFO - [cached since 133.2s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:38,924 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-31 00:09:45,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-31 00:09:45,008 - sqlalchemy.engine.Engine - INFO - SELECT "user".email, "user".hashed_password, "user".id 
FROM "user" 
WHERE "user".id = $1::UUID
2025-12-31 00:09:45,008 - sqlalchemy.engine.Engine - INFO - [cached since 139.7s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:45,010 - sqlalchemy.engine.Engine - INFO - SELECT user_version.head_id AS user_version_head_id, user_version.full_name AS user_version_full_name, user_version.role AS user_version_role, user_version.department AS user_version_department, user_version.is_active AS user_version_is_active, user_version.valid_from AS user_version_valid_from, user_version.valid_to AS user_version_valid_to, user_version.created_by_id AS user_version_created_by_id 
FROM user_version 
WHERE user_version.head_id IN ($1::UUID) ORDER BY user_version.valid_from DESC
2025-12-31 00:09:45,010 - sqlalchemy.engine.Engine - INFO - [cached since 139.7s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:45,012 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id AS user_preference_user_id, user_preference.id AS user_preference_id 
FROM user_preference 
WHERE user_preference.user_id IN ($1::UUID)
2025-12-31 00:09:45,012 - sqlalchemy.engine.Engine - INFO - [cached since 139.7s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:45,013 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:45,014 - sqlalchemy.engine.Engine - INFO - [cached since 120.2s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:45,015 - sqlalchemy.engine.Engine - INFO - SELECT user_preference.user_id, user_preference.id 
FROM user_preference 
WHERE user_preference.user_id = $1::UUID
2025-12-31 00:09:45,015 - sqlalchemy.engine.Engine - INFO - [cached since 139.3s ago] (UUID('faeb17b1-5129-4732-b179-e04781da4472'),)
2025-12-31 00:09:45,017 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id AS user_preference_version_head_id, user_preference_version.theme AS user_preference_version_theme, user_preference_version.valid_from AS user_preference_version_valid_from, user_preference_version.valid_to AS user_preference_version_valid_to, user_preference_version.created_by_id AS user_preference_version_created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id IN ($1::UUID) ORDER BY user_preference_version.valid_from DESC
2025-12-31 00:09:45,017 - sqlalchemy.engine.Engine - INFO - [cached since 139.3s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'),)
2025-12-31 00:09:45,018 - sqlalchemy.engine.Engine - INFO - SELECT user_preference_version.head_id, user_preference_version.theme, user_preference_version.valid_from, user_preference_version.valid_to, user_preference_version.created_by_id 
FROM user_preference_version 
WHERE user_preference_version.head_id = $1::UUID AND user_preference_version.valid_to IS NULL ORDER BY user_preference_version.valid_from DESC 
 LIMIT $2::INTEGER
2025-12-31 00:09:45,019 - sqlalchemy.engine.Engine - INFO - [cached since 120.2s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 1)
2025-12-31 00:09:45,020 - sqlalchemy.engine.Engine - INFO - UPDATE user_preference_version SET valid_to=$1::TIMESTAMP WITH TIME ZONE WHERE user_preference_version.head_id = $2::UUID AND user_preference_version.valid_from = $3::TIMESTAMP WITH TIME ZONE
2025-12-31 00:09:45,021 - sqlalchemy.engine.Engine - INFO - [cached since 120.2s ago] (datetime.datetime(2025, 12, 30, 23, 9, 45, 18386, tzinfo=datetime.timezone.utc), UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), datetime.datetime(2025, 12, 30, 23, 8, 1, 34391, tzinfo=datetime.timezone.utc))
2025-12-31 00:09:45,022 - sqlalchemy.engine.Engine - INFO - INSERT INTO user_preference_version (head_id, theme, valid_from, valid_to, created_by_id) VALUES ($1::UUID, $2::VARCHAR, $3::TIMESTAMP WITH TIME ZONE, $4::TIMESTAMP WITH TIME ZONE, $5::UUID)
2025-12-31 00:09:45,022 - sqlalchemy.engine.Engine - INFO - [cached since 139.3s ago] (UUID('c2cc570c-33f5-492b-a22d-55f6afbbb61f'), 'light', datetime.datetime(2025, 12, 30, 23, 9, 45, 18386, tzinfo=datetime.timezone.utc), None, UUID('faeb17b1-5129-4732-b179-e04781da4472'))
2025-12-31 00:09:45,023 - sqlalchemy.engine.Engine - INFO - COMMIT
